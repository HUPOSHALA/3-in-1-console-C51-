#include "ampire.h"
#include "Game.h"
#include "Snake.h"
uchar xdata score_bit;      //个位数数组的下标
uchar xdata score_ten;      //十位数数组的下标
extern snake xdata p;             //在sanke.c文件中已经定义，故这里要声明
extern uchar code y_move[]; //与上面同理

//创建食物
food xdata f;

//贪
uchar code text1[] =
    {
        0xDF, 0xDF, 0xEF, 0xEF, 0xD7, 0xDB, 0xDD, 0xD6, 0x4D, 0x9B, 0xD7, 0xEF, 0xEF, 0xDF, 0xDF, 0xFF,
        0xFF, 0x7F, 0x7F, 0x60, 0xBE, 0xBE, 0xDE, 0xE2, 0xFE, 0xDE, 0xDE, 0xA0, 0xBF, 0x7F, 0xFF, 0xFF};

//食
uchar code text2[] =
    {
        0xDF, 0xDF, 0xEF, 0x0F, 0x57, 0x5B, 0x55, 0x4E, 0x5D, 0x5B, 0x57, 0x0F, 0xEF, 0xDF, 0xDF, 0xFF,
        0xFF, 0xFF, 0xFF, 0x00, 0x7D, 0xBD, 0xDD, 0xF5, 0xF5, 0xED, 0xED, 0xD4, 0xBB, 0x7F, 0xFF, 0xFF

};

//蛇
uchar code text3[] =
    {

        0xFF, 0x07, 0xF7, 0x00, 0xF7, 0x07, 0xDF, 0xE7, 0x37, 0xF7, 0xF6, 0xF1, 0x77, 0xD7, 0xE7, 0xFF,
        0xDF, 0x9C, 0xDE, 0xE0, 0xEE, 0xE6, 0xCF, 0xFF, 0xC0, 0xBB, 0xBD, 0xBE, 0xBF, 0xBF, 0x87, 0xFF};

//数字0~9
uchar code number[10][16] = {
    {0xFF, 0x1F, 0xEF, 0xF7, 0xF7, 0xEF, 0x1F, 0xFF, 0xFF, 0xF0, 0xEF, 0xDF, 0xDF, 0xEF, 0xF0, 0xFF},
    {0xFF, 0xFF, 0xEF, 0xEF, 0x07, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xDF, 0xDF, 0xC0, 0xDF, 0xDF, 0xFF},
    {0xFF, 0x8F, 0xF7, 0xF7, 0xF7, 0xF7, 0x0F, 0xFF, 0xFF, 0xCF, 0xD7, 0xDB, 0xDD, 0xDE, 0xCF, 0xFF},
    {0xFF, 0xCF, 0xF7, 0xF7, 0xF7, 0x77, 0x8F, 0xFF, 0xFF, 0xE7, 0xDF, 0xDE, 0xDE, 0xDD, 0xE3, 0xFF},
    {0xFF, 0xFF, 0x7F, 0xBF, 0xCF, 0x07, 0xFF, 0xFF, 0xFF, 0xF9, 0xFA, 0xDB, 0xDB, 0xC0, 0xDB, 0xDB},
    {0xFF, 0x07, 0x77, 0x77, 0x77, 0xF7, 0xF7, 0xFF, 0xFF, 0xE6, 0xDF, 0xDF, 0xDF, 0xEE, 0xF1, 0xFF},
    {0xFF, 0x1F, 0xEF, 0x77, 0x77, 0x6F, 0xFF, 0xFF, 0xFF, 0xF0, 0xEE, 0xDF, 0xDF, 0xDF, 0xE0, 0xFF},
    {0xFF, 0xE7, 0xF7, 0xF7, 0x77, 0x97, 0xE7, 0xFF, 0xFF, 0xFF, 0xFF, 0xC1, 0xFE, 0xFF, 0xFF, 0xFF},
    {0xFF, 0x8F, 0x77, 0xF7, 0xF7, 0x77, 0x8F, 0xFF, 0xFF, 0xE3, 0xDD, 0xDE, 0xDE, 0xDD, 0xE3, 0xFF},
    {0xFF, 0x0F, 0xF7, 0xF7, 0xF7, 0xEF, 0x1F, 0xFF, 0xFF, 0xFE, 0xED, 0xDD, 0xDD, 0xEE, 0xF0, 0xFF}

};

//字母gameover
uchar code gameover_text[8][16] =
    {
        {0xC0, 0x30, 0x08, 0x08, 0x08, 0x38, 0x00, 0x00, 0x07, 0x18, 0x20, 0x20, 0x22, 0x1E, 0x02, 0x00},
        {0x00, 0x00, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x19, 0x24, 0x24, 0x12, 0x3F, 0x20, 0x00},
        {0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x20, 0x3F, 0x20, 0x00, 0x3F, 0x20, 0x00, 0x3F},
        {0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x1F, 0x24, 0x24, 0x24, 0x24, 0x17, 0x00},
        {0xE0, 0x10, 0x08, 0x08, 0x08, 0x10, 0xE0, 0x00, 0x0F, 0x10, 0x20, 0x20, 0x20, 0x10, 0x0F, 0x00},
        {0x80, 0x80, 0x80, 0x00, 0x80, 0x80, 0x80, 0x00, 0x00, 0x03, 0x0C, 0x30, 0x0C, 0x03, 0x00, 0x00},
        {0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x1F, 0x24, 0x24, 0x24, 0x24, 0x17, 0x00},
        {0x80, 0x80, 0x80, 0x00, 0x80, 0x80, 0x80, 0x00, 0x20, 0x20, 0x3F, 0x21, 0x20, 0x00, 0x01, 0x00}};

//字母score
uchar code score_text[5][16] =
    {
        {0xFF, 0x8F, 0x77, 0xF7, 0xF7, 0xF7, 0xC7, 0xFF, 0xFF, 0xC7, 0xDF, 0xDE, 0xDE, 0xDD, 0xE3, 0xFF},
        {0xFF, 0xFF, 0xFF, 0x7F, 0x7F, 0x7F, 0xFF, 0xFF, 0xFF, 0xF1, 0xEE, 0xDF, 0xDF, 0xDF, 0xEE, 0xFF},
        {0xFF, 0xFF, 0x7F, 0x7F, 0x7F, 0x7F, 0xFF, 0xFF, 0xFF, 0xE0, 0xDF, 0xDF, 0xDF, 0xDF, 0xE0, 0xFF},
        {0x7F, 0x7F, 0x7F, 0xFF, 0x7F, 0x7F, 0x7F, 0xFF, 0xDF, 0xDF, 0xC0, 0xDE, 0xDF, 0xFF, 0xFE, 0xFF},
        {0xFF, 0xFF, 0x7F, 0x7F, 0x7F, 0x7F, 0xFF, 0xFF, 0xFF, 0xE0, 0xDB, 0xDB, 0xDB, 0xDB, 0xE8, 0xFF}};

//文字打印 （行 列 数组 宽度）
void print(uchar row, uchar column, uchar *text, uchar width)
{
    uchar i, j;
    for (i = 0; i < 2; i++) //字母和文字取模后的高度都是16，但宽度字母是8，文字是16
    {
        set_row(row + i);
        set_column(column);
        for (j = 0; j < width; j++)
        {
            write_data(text[width * i + j]);
        }
    }
}

//食物初始化
void food_initate()
{
    f.x = 32; //初始化食物的坐标x,y
    f.y = 32;
    f.score = 0;   //得分初始化为0
    score_bit = 0; //个位数组的下标初始化为0
    score_ten = 0; //十位数组的下标初始化为0
}

//显示食物
void food_display()
{
    uchar row;
    uchar coulumn;
    uchar ix;
    row = f.y / 8; //计算目前食物所在页
    set_row(row);
    ix = f.y % 8;
    coulumn = f.x; //得到食物所在的列数
    set_column(coulumn);
    write_data(y_move[ix]);
}

//判断食物是否被吃到
void food_touch()
{
    if (p.body[0].x == f.x && p.body[0].y == f.y) //食物的坐标与蛇头的坐标相等
    {
        set_row(f.x);
        set_column(f.y);
        write_data(0xff);  //清除原本食物的位置
        f.x = rand() % 63; //随机生成食物的新的x坐标
        f.y = rand() % 63; //随机生成食物的新的y坐标
        f.score++;         //分数+1
        score_bit++;       //个位数组的下标+1
        p.Num++;           //蛇的身体+1

        if (f.score % 10 == 0 && f.score != 0) //每得10分时，重置个位数组下标，十位数组下标+1
        {
            score_ten++;
            score_bit = 0;
        }
    }
}

//显示分数
void score_display()
{
    select_secreen(2);                  //分数在右屏打印
    print(4, 32, number[score_ten], 8); //打印十位的数字
    print(4, 40, number[score_bit], 8); //打印个位的数字
    select_secreen(3);                  //切换回左屏
}

//游戏结束判定条件
int game_over()
{
    select_secreen(3);
    if (!snack_collision()) //蛇撞墙时结束游戏，清屏并打印信息
    {

        //打印gameover
        print(2, 0, gameover_text[0], 8);
        print(2, 8, gameover_text[1], 8);
        print(2, 16, gameover_text[2], 8);
        print(2, 24, gameover_text[3], 8);
        print(2, 32, gameover_text[4], 8);
        print(2, 40, gameover_text[5], 8);
        print(2, 48, gameover_text[6], 8);
        print(2, 56, gameover_text[7], 8);

        return 1;
    }
    return 0;
}

//打印游戏中不会改变的信息
void print_gamemessage()
{
    uchar l;
    select_secreen(2);              //在右屏打印
    print(0, 8, text1, 16);         //贪
    print(0, 24, text2, 16);        //食
    print(0, 40, text3, 16);        //蛇
    print(2, 8, score_text[0], 8);  //字母s
    print(2, 16, score_text[1], 8); //字母c
    print(2, 24, score_text[2], 8); //字母o
    print(2, 32, score_text[3], 8); //字母r
    print(2, 40, score_text[4], 8); //字母e
    print(4, 8, number[0], 8);      //数字0  万位    （所以这里设置的最高分99）不过显然不可能蛇的长度都不可能这么长
    print(4, 16, number[0], 8);     //数字0  千位
    print(4, 24, number[0], 8);     //数字0  百位


    //打印右边的边界线
    for (l = 0; l < 8; l++)
    {
        select_secreen(3); //左屏打印
        set_row(l);        //每一页都打印
        set_column(63);
        write_data(0);
    }
}
